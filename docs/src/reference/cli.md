# CLI Reference

Complete reference for the `reflectapi-cli` command-line tool.

## Installation

```bash
# Install from crates.io
cargo install reflectapi-cli

# Or install from source
git clone https://github.com/thepartly/reflectapi
cd reflectapi
cargo install --path reflectapi-cli
```

## Usage

```bash
reflectapi [OPTIONS] <COMMAND>
```

### Global Options

- `-d, --debug...` - Turn debugging information on (can be repeated for more verbosity)
- `-h, --help` - Print help information
- `-V, --version` - Print version information

## Commands

### `codegen` - Generate Client Code

Generate client libraries from a ReflectAPI schema.

```bash
reflectapi codegen [OPTIONS] --language <LANGUAGE>
```

#### Required Options

- `-l, --language <LANGUAGE>` - Target language for code generation
  - `typescript` - Generate TypeScript/JavaScript client
  - `rust` - Generate Rust client
  - `python` - Generate Python client  
  - `openapi` - Generate OpenAPI 3.0 specification

#### Common Options

- `-s, --schema <FILE>` - Path to the ReflectAPI schema JSON file
- `-o, --output <FILE>` - Target directory for generated code
- `-t, --typecheck` - Run type checking on generated code
- `-f, --format` - Format the generated code
- `-I, --instrument` - Add tracing instrumentation to generated code

#### Filtering Options

- `-i, --include-tags <INCLUDE_TAGS>` - Only include types/endpoints with specified tags
- `-e, --exclude-tags <EXCLUDE_TAGS>` - Exclude types/endpoints with specified tags

#### Language-Specific Options

**Rust:**
- `--shared-modules <SHARED_MODULES>` - Modules to exclude from generation (use existing crates)

**Python:**
- `--python-package-name <PYTHON_PACKAGE_NAME>` - Package name (default: `api_client`)
- `--python-async` - Generate async client (default: true)
- `--python-sync` - Generate sync client (default: false)
- `--python-testing` - Generate testing utilities (default: false)

#### Examples

**Generate TypeScript client:**
```bash
reflectapi-cli codegen \
  --language typescript \
  --schema api-schema.json \
  --output clients/typescript \
  --format
```

**Generate Python client with sync support:**
```bash
reflectapi-cli codegen \
  --language python \
  --schema api-schema.json \
  --output clients/python \
  --python-package-name my_api \
  --python-sync \
  --python-testing
```

**Generate Rust client with shared modules:**
```bash
reflectapi-cli codegen \
  --language rust \
  --schema api-schema.json \
  --output clients/rust \
  --shared-modules serde,uuid,chrono \
  --format
```

**Generate OpenAPI spec:**
```bash
reflectapi-cli codegen \
  --language openapi \
  --schema api-schema.json \
  --output openapi.json
```

### `doc` - Documentation Commands

Serve interactive documentation for your API schema.

```bash
reflectapi doc <COMMAND>
```

#### Subcommands

**`open` - Serve Documentation:**
```bash
reflectapi-cli doc open --schema api-schema.json
```

Opens a local web server with interactive API documentation.

## Configuration

### Schema File Format

The CLI expects a ReflectAPI schema in JSON format, typically generated by your Rust application:

```rust,ignore
// In your Rust app
let (schema, _routers) = builder.build()?;
let schema_json = serde_json::to_string_pretty(&schema)?;
std::fs::write("api-schema.json", schema_json)?;
```

### Environment Variables

- `REFLECTAPI_DEBUG` - Enable debug logging (equivalent to `-d`)
- `REFLECTAPI_SCHEMA` - Default schema file path
- `REFLECTAPI_OUTPUT` - Default output directory

## Integration Patterns

### Build Scripts

Integrate client generation into your build process:

**Makefile:**
```makefile
.PHONY: generate-clients
generate-clients: api-schema.json
	reflectapi-cli codegen -l typescript -s $< -o clients/typescript -f
	reflectapi-cli codegen -l python -s $< -o clients/python -f
	reflectapi-cli codegen -l rust -s $< -o clients/rust -f

api-schema.json: src/main.rs
	cargo run --bin my-api
```

**Package.json script:**
```json
{
  "scripts": {
    "generate": "reflectapi-cli codegen -l typescript -s api-schema.json -o src/api -f",
    "build": "npm run generate && tsc"
  }
}
```

### CI/CD Integration

**GitHub Actions:**
```yaml
- name: Generate API clients
  run: |
    cargo run --bin my-api  # Generate schema
    reflectapi-cli codegen -l typescript -s api-schema.json -o clients/typescript
    reflectapi-cli codegen -l python -s api-schema.json -o clients/python

- name: Validate generated code
  run: |
    cd clients/typescript && npm install && npm run build
    cd clients/python && python -m py_compile *.py
```

## Advanced Usage

### Selective Generation

Use tags to control what gets generated:

```rust,ignore
// In your Rust code
#[derive(Input, Output)]
#[reflectapi(tags = "v1,public")]
struct PublicUser {
    id: u32,
    name: String,
}

#[derive(Input, Output)]  
#[reflectapi(tags = "internal")]
struct InternalUser {
    id: u32,
    name: String,
    email: String,
    admin: bool,
}
```

```bash
# Generate only public API
reflectapi-cli codegen -l typescript -s schema.json -o clients/public -i public

# Generate only internal API  
reflectapi-cli codegen -l typescript -s schema.json -o clients/internal -i internal
```

### Custom Output Structure

Control where different languages are generated:

```bash
# Mono-repo structure
reflectapi-cli codegen -l typescript -s schema.json -o packages/api-client
reflectapi-cli codegen -l python -s schema.json -o python-sdk/src
reflectapi-cli codegen -l rust -s schema.json -o rust-client/src
```

## Troubleshooting

### Common Issues

**Schema not found:**
```bash
reflectapi-cli codegen -l typescript -s api-schema.json -o clients
# Error: No such file or directory (os error 2)
```
- Ensure schema file exists and path is correct
- Generate schema first: `cargo run --bin your-app`

**Permission denied:**
```bash
# Error: Permission denied (os error 13)
```
- Check write permissions on output directory
- Create directory first: `mkdir -p clients/typescript`

**Invalid schema:**
```bash
# Error: Failed to parse schema: invalid JSON
```
- Validate JSON: `cat api-schema.json | jq`
- Regenerate schema with updated ReflectAPI version

**Missing dependencies in generated code:**
```bash
# TypeScript: Cannot find module 'node-fetch'
# Python: ModuleNotFoundError: 'httpx'
```
- Install required dependencies for generated clients
- See [Client Generation Guide](../how-to/clients.md) for setup instructions

### Performance Tips

1. **Use formatting only when needed** - `--format` can be slow for large codebases
2. **Enable type checking** - `--typecheck` catches issues early
3. **Use include/exclude tags** - Generate only what you need
4. **Cache schema files** - Avoid regenerating if Rust code hasn't changed

## Migration Guide

### From v0.14 to v0.15

- CLI renamed from `reflectapi` to `reflectapi-cli`
- New `--python-async` flag (defaults to true)
- Removed deprecated `--typescript-runtime` option

### From Earlier Versions

- Schema format changed - regenerate schema files
- Some CLI flags renamed for consistency
- See [CHANGELOG](https://github.com/thepartly/reflectapi/blob/main/CHANGELOG.md) for details

## See Also

- [Client Generation Guide](../how-to/clients.md) - Complete workflow guide
- [Feature Flags Reference](./features.md) - Build configuration options
- [Troubleshooting](./troubleshooting.md) - Common issues and solutions